---
layout:   post
title:    AVR again (AVR-GSM + AVR-JTAG-USB-A)
author:   flex
category: 2022
tags:     [compÃºter]
comments: false

headerSIZE:       '0px'
headerBGimagex:   ''
headerBGposition: 'background-position: center;'

contentLEFT: '<p style="padding: 20px;"><img src="images/Apple_MBP16Touch-Silver-2019_nobg.png"></p>'
---

In the knowledge of that, I won't be working in the way like ordinary people do for a while, it occurred to me that I should pull this old funny project out of the drawer for a bit.

Annak a tudatÃ¡ban, hogy most egy ideig nem fogok a hÃ©tkÃ¶znapi emberek Ã¡ltal megszokott mÃ³don dolgozni, eszembe jutott, hogy elÅ‘ kellne venni a fiÃ³k mÃ©lyÃ©rÅ‘l ezt a  rÃ©gi projektet egy picit

https://www.olimex.com/Products/AVR/Development/AVR-GSM/

https://www.olimex.com/Products/AVR/Programmers/AVR-JTAG-USB-A/

$ cd ~flex/development/AVR/newAVR-GSM-SMS2/

21:34:02 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [0]
$ make

-------- begin --------
expr: syntax error
sh: line 0: [: -eq: unary operator expected
usage:
touch [-A [-][[hh]mm]SS] [-acfhm] [-r file] [-t [[CC]YY]MMDDhhmm[.SS]] file ...
/usr/local/CrossPack-AVR/bin/avr-gcc: line 3: /usr/local/CrossPack-AVR-20090415/avr-3/bin/gcc: Bad CPU type in executable
/usr/local/CrossPack-AVR/bin/avr-gcc: line 3: /usr/local/CrossPack-AVR-20090415/avr-3/bin/gcc: Undefined error: 0
make: *** [gccversion] Error 1

21:34:03 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [2]
$ sudo /usr/local/CrossPack-AVR/uninstall
Password:
Are you sure you want to uninstall CrossPack for AVR Development 20090415?
[y/N]
y
Starting uninstall.
CrossPack for AVR Development is now removed.

21:34:57 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [0]
$ sudo /usr/local/CrossPack-AVR/uninstall
sudo: /usr/local/CrossPack-AVR/uninstall: command not found

21:35:02 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [1]
$ sudo /usr/local/CrossPack-AVR-201
CrossPack-AVR-20120217/ CrossPack-AVR-20130212/

21:35:02 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [1]
$ sudo /usr/local/CrossPack-AVR-20130212/uninstall
Are you sure you want to uninstall CrossPack for AVR Development 20130212?
[y/N]
y
Starting uninstall.
CrossPack for AVR Development is now removed.

21:35:21 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [0]
$ make

-------- begin --------
expr: syntax error
sh: line 0: [: -eq: unary operator expected
usage:
touch [-A [-][[hh]mm]SS] [-acfhm] [-r file] [-t [[CC]YY]MMDDhhmm[.SS]] file ...
sh: avr-gcc: command not found
make: *** [gccversion] Error 127

21:35:43 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [2]
$ brew link osx-cross/avr/avr-gcc@11
Warning: avr-gcc@11 is keg-only and must be linked with `--force`.

If you need to have this software first in your PATH instead consider running:
  echo 'export PATH="/usr/local/opt/avr-gcc@11/bin:$PATH"' >> ~/.profile

21:36:20 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [0]
$ brew link --force osx-cross/avr/avr-gcc@11
Linking /usr/local/Cellar/avr-gcc@11/11.3.0... 22 symlinks created.

If you need to have this software first in your PATH instead consider running:
  echo 'export PATH="/usr/local/opt/avr-gcc@11/bin:$PATH"' >> ~/.profile

21:36:39 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [0]
$ make

-------- begin --------
expr: syntax error
sh: line 0: [: -eq: unary operator expected
usage:
touch [-A [-][[hh]mm]SS] [-acfhm] [-r file] [-t [[CC]YY]MMDDhhmm[.SS]] file ...
avr-gcc (Homebrew AVR GCC 11.3.0) 11.3.0
Copyright (C) 2021 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.


Size before:
AVR-GSM-SMS.elf  :
section                     size      addr
.text                      14544         0
.data                        936   8388704
.bss                         420   8389640
.comment                      38         0
.note.gnu.avr.deviceinfo      60         0
.debug_aranges               328         0
.debug_info                22744         0
.debug_abbrev               4476         0
.debug_line                21451         0
.debug_frame                1752         0
.debug_str                  2741         0
.debug_line_str              566         0
.debug_loclists             6565         0
.debug_rnglists              120         0
Total                      76741




Compiling: AVR-GSM-SMS.c
avr-gcc -c -mmcu=atmega32 -I. -g -DF_CPU=7372800UL    -Os -funsigned-char -funsigned-bitfields -fpack-struct -fshort-enums -Wall -Wstrict-prototypes -Wa,-adhlns=AVR-GSM-SMS.lst  -std=gnu99 -MD -MP -MF .dep/AVR-GSM-SMS.o.d AVR-GSM-SMS.c -o AVR-GSM-SMS.o
In file included from AVR-GSM-SMS.c:46:
AVR-GSM-SMS.c: In function 'main':
AVR-GSM-SMS.c:980:81: warning: pointer targets in passing argument 2 of 'lcd_morph_p' differ in signedness [-Wpointer-sign]
  980 |       if ( In_OPT2() ) lcd_morph_P( "Home Automation by   _flex from FleXoft.", rand_matrix1 );
	  |                                                                                 ^~~~~~~~~~~~
	  |                                                                                 |
	  |                                                                                 const unsigned char *
AVR-GSM.h:60:59: note: in definition of macro 'lcd_morph_P'
   60 | #define lcd_morph_P( __p, __r ) lcd_morph_p( PSTR( __p ), __r )
	  |                                                           ^~~
AVR-GSM.h:59:53: note: expected 'const char *' but argument is of type 'const unsigned char *'
   59 | extern void lcd_morph_p( const char *p, const char *r );
	  |                                         ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1033:52: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1033 |           if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix2 );
	  |                                                    ^~~~~~~~~~~~
	  |                                                    |
	  |                                                    const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1059:48: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1059 |       if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix5 );
	  |                                                ^~~~~~~~~~~~
	  |                                                |
	  |                                                const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1090:54: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1090 |             if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix1 );
	  |                                                      ^~~~~~~~~~~~
	  |                                                      |
	  |                                                      const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1106:49: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1106 |       if ( In_OPT2() ) lcd_morph( generalPage , rand_matrix2 );
	  |                                                 ^~~~~~~~~~~~
	  |                                                 |
	  |                                                 const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1115:81: warning: pointer targets in passing argument 2 of 'lcd_morph_p' differ in signedness [-Wpointer-sign]
 1115 |       if ( In_OPT2() ) lcd_morph_P( " www.fleischmann.hu gyorgy@fleishmann.hu", rand_matrix3 );
	  |                                                                                 ^~~~~~~~~~~~
	  |                                                                                 |
	  |                                                                                 const unsigned char *
AVR-GSM.h:60:59: note: in definition of macro 'lcd_morph_P'
   60 | #define lcd_morph_P( __p, __r ) lcd_morph_p( PSTR( __p ), __r )
	  |                                                           ^~~
AVR-GSM.h:59:53: note: expected 'const char *' but argument is of type 'const unsigned char *'
   59 | extern void lcd_morph_p( const char *p, const char *r );
	  |                                         ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1137:48: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1137 |       if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix4 );
	  |                                                ^~~~~~~~~~~~
	  |                                                |
	  |                                                const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1150:48: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1150 |       if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix4 );
	  |                                                ^~~~~~~~~~~~
	  |                                                |
	  |                                                const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1165:48: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1165 |       if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix4 );
	  |                                                ^~~~~~~~~~~~
	  |                                                |
	  |                                                const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1186:48: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1186 |       if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix1 );
	  |                                                ^~~~~~~~~~~~
	  |                                                |
	  |                                                const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1208:48: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1208 |       if ( In_OPT2() ) lcd_morph( generalPage, rand_matrix1 );
	  |                                                ^~~~~~~~~~~~
	  |                                                |
	  |                                                const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1221:48: warning: pointer targets in passing argument 2 of 'lcd_morph' differ in signedness [-Wpointer-sign]
 1221 |       if ( In_OPT2() ) lcd_morph( smsSentPage, rand_matrix5 );
	  |                                                ^~~~~~~~~~~~
	  |                                                |
	  |                                                const unsigned char *
In file included from AVR-GSM-SMS.c:46:
AVR-GSM.h:57:45: note: expected 'const char *' but argument is of type 'const unsigned char *'
   57 | extern void lcd_morph( char *p, const char *r );
	  |                                 ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1230:81: warning: pointer targets in passing argument 2 of 'lcd_morph_p' differ in signedness [-Wpointer-sign]
 1230 |       if ( In_OPT2() ) lcd_morph_P( "1www.fleischmann.hu gyorgy@fleishmann.hu", rand_matrix3 );
	  |                                                                                 ^~~~~~~~~~~~
	  |                                                                                 |
	  |                                                                                 const unsigned char *
AVR-GSM.h:60:59: note: in definition of macro 'lcd_morph_P'
   60 | #define lcd_morph_P( __p, __r ) lcd_morph_p( PSTR( __p ), __r )
	  |                                                           ^~~
AVR-GSM.h:59:53: note: expected 'const char *' but argument is of type 'const unsigned char *'
   59 | extern void lcd_morph_p( const char *p, const char *r );
	  |                                         ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1239:81: warning: pointer targets in passing argument 2 of 'lcd_morph_p' differ in signedness [-Wpointer-sign]
 1239 |       if ( In_OPT2() ) lcd_morph_P( "2www.fleischmann.hu gyorgy@fleishmann.hu", rand_matrix3 );
	  |                                                                                 ^~~~~~~~~~~~
	  |                                                                                 |
	  |                                                                                 const unsigned char *
AVR-GSM.h:60:59: note: in definition of macro 'lcd_morph_P'
   60 | #define lcd_morph_P( __p, __r ) lcd_morph_p( PSTR( __p ), __r )
	  |                                                           ^~~
AVR-GSM.h:59:53: note: expected 'const char *' but argument is of type 'const unsigned char *'
   59 | extern void lcd_morph_p( const char *p, const char *r );
	  |                                         ~~~~~~~~~~~~^
AVR-GSM-SMS.c:1336:9: warning: implicit declaration of function 'uart_wait_for_empty_buffer'; did you mean 'uart_wait_for_emty_buffer'? [-Wimplicit-function-declaration]
 1336 |         uart_wait_for_empty_buffer();
	  |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
	  |         uart_wait_for_emty_buffer
AVR-GSM-SMS.c: In function 'waiting_for_carrier_and_put_temporary_buffer':
AVR-GSM-SMS.c:572:1: warning: control reaches end of non-void function [-Wreturn-type]
  572 | }
	  | ^
At top level:
AVR-GSM-SMS.c:323:27: warning: 'smsSentPage_' defined but not used [-Wunused-const-variable=]
  323 | static const PROGMEM char smsSentPage_[] =         "Status SMS sent to:        ____________.";
	  |                           ^~~~~~~~~~~~
AVR-GSM-SMS.c: In function 'send_sms_status':
AVR-GSM-SMS.c:524:44: warning: 'sprintf' writing a terminating nul past the end of the destination [-Wformat-overflow=]
  524 |   sprintf( teszt, "1:%2d 2:%2d 3:%2d 4: %2d", aa, i, bb, cc);
	  |                                            ^
AVR-GSM-SMS.c:524:3: note: 'sprintf' output between 21 and 37 bytes into a destination of size 20
  524 |   sprintf( teszt, "1:%2d 2:%2d 3:%2d 4: %2d", aa, i, bb, cc);
	  |   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Linking: AVR-GSM-SMS.elf
avr-gcc -mmcu=atmega32 -I. -g -DF_CPU=7372800UL    -Os -funsigned-char -funsigned-bitfields -fpack-struct -fshort-enums -Wall -Wstrict-prototypes -Wa,-adhlns=AVR-GSM-SMS.o  -std=gnu99 -MD -MP -MF .dep/AVR-GSM-SMS.elf.d AVR-GSM-SMS.o lcd.o uart.o twimaster.o AVR-GSM.o --output AVR-GSM-SMS.elf -Wl,-Map=AVR-GSM-SMS.map,--cref    -lm

Creating load file for Flash: AVR-GSM-SMS.hex
avr-objcopy -O ihex -R .eeprom AVR-GSM-SMS.elf AVR-GSM-SMS.hex

Creating load file for EEPROM: AVR-GSM-SMS.eep
avr-objcopy -j .eeprom --set-section-flags=.eeprom="alloc,load" \
	--change-section-lma .eeprom=0 -O ihex AVR-GSM-SMS.elf AVR-GSM-SMS.eep
avr-objcopy: --change-section-lma .eeprom=0x0000000000000000 never used

Creating Extended Listing: AVR-GSM-SMS.lss
avr-objdump -h -S AVR-GSM-SMS.elf > AVR-GSM-SMS.lss

Creating Symbol Table: AVR-GSM-SMS.sym
avr-nm -n AVR-GSM-SMS.elf > AVR-GSM-SMS.sym

Size after:
AVR-GSM-SMS.elf  :
section                     size      addr
.text                      14544         0
.data                        936   8388704
.bss                         420   8389640
.comment                      38         0
.note.gnu.avr.deviceinfo      60         0
.debug_aranges               328         0
.debug_info                22744         0
.debug_abbrev               4476         0
.debug_line                21451         0
.debug_frame                1752         0
.debug_str                  2741         0
.debug_line_str              566         0
.debug_loclists             6565         0
.debug_rnglists              120         0
Total                      76741



-------- end --------


21:36:44 Wed Jun 15 [flex@flexs-MacBook-Pro-16:[~/development/AVR/newAVR-GSM-SMS2] [0]


Let's see what happens when I do this:

<pre class="terminal">
14:56:26 Tue Jun 14 [flex@MBP16:[~/Downloads] [0]
$ <strong>sudo vi /etc/hosts</strong>

15:01:36 Tue Jun 14 [flex@MBP16:[~/Downloads] [0]
$ <strong>cat /etc/hosts</strong>
##
# Host Database
#
# localhost is used to configure the loopback interface
# when the system is booting.  Do not change this entry.
##
127.0.0.1	    localhost
255.255.255.255	broadcasthost
::1             localhost
fe80::1%lo0	    localhost

<strong>127.0.0.1 index.hu telex.hu 444.hu</strong>

15:02:47 Tue Jun 14 [flex@MBP16:[~/Downloads] [0]
</pre>

ðŸ¤ž